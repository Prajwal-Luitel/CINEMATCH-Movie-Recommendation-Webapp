{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CinemaMatch - Analytics</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <link rel="stylesheet" href="{% static 'css/analytics.css' %}">
</head>

<body>
    <!-- Navigation Bar -->
    <nav>
        <div class="logo">
            <img src="{% static 'logo/cinematch logo.png' %}" alt="Logo" class="logo-img">
            <div class="logo-text"><span class="cine">CINE</span><span class="match">MATCH</span></div>
        </div>
         <div class="nav-links">
            <a href="{% url 'home' %}" >Home</a>
            <a href="{% url 'grossing' %}">Grossing</a>
             <a href="{% url 'analytics' %}" class="active">Analytics</a>
        </div>
    </nav>

    <!-- Main Content -->
    <main>
        <section class="page-title">
            <h1>Movie Analytics</h1>
            <p>Explore insights and trends in the film industry through data visualization</p>
        </section>

        <!-- Genre Distribution Section -->
        <section class="analytics-section">
            <div class="section-header">
                <h2>Genre Distribution (Top 10)</h2>
            </div>

            <div class="charts-container">
                <div class="chart-wrapper full-width-chart">
                    <h3 class="chart-title">Market Share by Genre</h3>
                    <div class="chart-container">
                        <canvas id="genreChart"></canvas>
                    </div>
                </div>

            </div>
        </section>

        <!-- Budget vs Revenue Section -->
        <section class="analytics-section">
            <div class="section-header">
                <h2>Budget vs Revenue Analysis</h2>
            </div>

            <div class="charts-container">
                <div class="chart-wrapper full-width-chart">
                    <h3 class="chart-title">Budget vs Revenue Correlation (in millions $)</h3>
                    <div class="chart-container">
                        <canvas id="budgetRevenueChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Revenue per Year Section -->
        <section class="analytics-section">
            <div class="section-header">
                <h2>Revenue Trends Over Time</h2>
            </div>

            <div class="charts-container">
                <div class="chart-wrapper full-width-chart">
                    <h3 class="chart-title">Average Revenue per Year (in millions $)</h3>
                    <div class="chart-container">
                        <canvas id="revenueYearChart"></canvas>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="social-links">
                <a href="https://www.facebook.com/" target="_blank" rel="noopener noreferrer">
                    <i class="fab fa-facebook"></i>
                </a>
                <a href="https://twitter.com/" target="_blank" rel="noopener noreferrer">
                    <i class="fab fa-twitter"></i>
                </a>
                <a href="https://www.instagram.com/" target="_blank" rel="noopener noreferrer">
                    <i class="fab fa-instagram"></i>
                </a>
                <a href="https://www.youtube.com/" target="_blank" rel="noopener noreferrer">
                    <i class="fab fa-youtube"></i>
                </a>
            </div>
            <div class="copyright">
                &copy; 2025 CinemaMatch. All rights reserved.
            </div>
        </div>
    </footer>

    <script>

    document.addEventListener('DOMContentLoaded', function() {
        // Genre Distribution (from backend)
        const genreData = {
            labels: {{ genre_labels|safe }},
            datasets: [{
                data: {{ genre_values|safe }},
                backgroundColor: [
                    '#ff0000','#ff5252','#ff7b7b','#ffa7a7',
                    '#36a2eb','#4bc0c0','#faa61a','#ffcd56',
                    '#8dd3c7','#bebada'
                ],
                borderColor: '#1a1a1a',
                borderWidth: 2
            }]
        };

        // Budget vs Revenue
        
        const budgetRevenueData = {
            datasets: [{
            label: 'Movies',
            data: {{ budget_revenue|safe }},
            backgroundColor: '#ff0000',
            borderColor: '#ff5252',
            pointRadius: 2,
            pointHoverRadius: 0 // disable to remove the lag
        }]
    };

        // Revenue per Year
        const revenueYearData = {
            labels: {{ years|safe }},
            datasets: [{
                label: 'Average Revenue (in millions $)',
                data: {{ avg_revenues|safe }},
                fill: false,
                borderColor: '#ff0000',
                tension: 0.3,
                pointBackgroundColor: '#ff0000',
                pointRadius: 5,
                pointHoverRadius: 7
            }]
        };

            // Chart options
            const pieOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                        labels: {
                            color: '#f5f5f5',
                            font: {
                                size: 12
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function (context) {
                                return context.label + ': ' + context.raw;
                            }
                        }
                    },
                    datalabels: {
                        color: '#000',
                        formatter: function (value, context) {
                            let total = context.chart._metasets[context.datasetIndex].total;
                            let percentage = ((value / total) * 100).toFixed(1);
                            return percentage + '%';
                        }
                    }
                },
                
            };

            const scatterOptions = {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        type: 'linear',
                        title: {
                            display: true,
                            text: 'Budget (in millions $)',
                            color: '#f5f5f5'
                        },
                        ticks: { color: '#f5f5f5' },
                        grid: { color: '#333' },
                        min: 0,
                        max: 300   
                    },
                    y: {
                        type: 'linear',
                        title: {
                            display: true,
                            text: 'Revenue (in millions $)',
                            color: '#f5f5f5'
                        },
                        ticks: { color: '#f5f5f5' },
                        grid: { color: '#333' },
                        min: 0,
                        max: 1500  
                    }
                },
                plugins: {
                    legend: {
                        labels: { color: '#f5f5f5' }
                    },
                    tooltip: { enabled: false }
                },
                interaction: { mode: null }
            };


            const lineOptions = {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        ticks: {
                            color: '#f5f5f5'
                        },
                        grid: {
                            color: '#333'
                        },
                        max: 2025 
                    },
                    y: {
                        ticks: {
                            color: '#f5f5f5'
                        },
                        grid: {
                            color: '#333'
                        }
                    }
                },
                plugins: {
                    legend: {
                        labels: {
                            color: '#f5f5f5'
                        }
                    }
                }
            };

            // Create charts
            new Chart(document.getElementById('genreChart'), {
                type: 'pie',
                data: genreData,
                options: pieOptions,
                plugins: [ChartDataLabels]
            });

            new Chart(document.getElementById('budgetRevenueChart'), {
                type: 'scatter',
                data: budgetRevenueData,
                options: scatterOptions
            });

            new Chart(document.getElementById('revenueYearChart'), {
                type: 'line',
                data: revenueYearData,
                options: lineOptions
            });
    });
</script>

</body>

</html>